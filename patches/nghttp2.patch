diff --git a/CMakeLists.txt b/CMakeLists.txt
index 6e0a5236..14307b21 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -176,9 +176,11 @@ add_custom_target(check COMMAND ${CMAKE_CTEST_COMMAND})
 # openssl (for src)
 include(CheckSymbolExists)
 set(HAVE_OPENSSL    ${OPENSSL_FOUND})
-if(NOT ENABLE_LIB_ONLY AND OPENSSL_FOUND)
+if(OPENSSL_FOUND)
   set(OPENSSL_INCLUDE_DIRS  ${OPENSSL_INCLUDE_DIR})
-  cmake_push_check_state()
+  if(NOT ENABLE_LIB_ONLY)
+    cmake_push_check_state()
+  endif()
   set(CMAKE_REQUIRED_INCLUDES   "${OPENSSL_INCLUDE_DIR}")
   set(CMAKE_REQUIRED_LIBRARIES  "${OPENSSL_LIBRARIES}")
   if(WIN32)
@@ -194,7 +196,9 @@ if(NOT ENABLE_LIB_ONLY AND OPENSSL_FOUND)
       endif()
     endif()
   endif()
-  cmake_pop_check_state()
+  if(NOT ENABLE_LIB_ONLY)
+    cmake_pop_check_state()
+  endif()
 else()
   set(OPENSSL_INCLUDE_DIRS  "")
   set(OPENSSL_LIBRARIES     "")
